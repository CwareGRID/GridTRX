<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grid ‚Äî Client Library</title>
  <style>
    :root {
      --bg: #fafaf8; --surface: #ffffff; --border: #d4d0c8;
      --text: #1a1a18; --muted: #6b6860; --accent: #2c5282;
      --accent-light: #e8f0fe; --pos: #1a6b3c; --neg: #b91c1c;
      --sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      --mono: 'Consolas', 'SF Mono', 'Menlo', monospace;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: var(--sans); font-size:14px; color:var(--text); background:var(--bg); }
    
    .header {
      background: #2d3748; color: #e2e8f0; padding: 16px 24px;
      display: flex; align-items: center; gap: 12px;
    }
    .header h1 { font-size: 18px; font-weight: 700; letter-spacing: 1px; color: #90cdf4; }
    .header .tag { font-size: 12px; color: #a0aec0; margin-left: 8px; }
    
    .container { max-width: 700px; margin: 0 auto; padding: 24px; }
    
    .flash { padding:8px 14px; margin-bottom:12px; border-radius:4px; font-size:13px; }
    .flash-success { background:#d4edda; color:#155724; }
    .flash-error { background:#f8d7da; color:#721c24; }
    
    .section { margin-bottom: 24px; }
    .section h2 { font-size: 15px; font-weight: 600; margin-bottom: 8px; }
    .section p { font-size: 13px; color: var(--muted); margin-bottom: 12px; }
    
    .path-form {
      display: flex; gap: 8px; align-items: center;
    }
    .path-form input {
      flex: 1; padding: 8px 12px; border: 1px solid var(--border);
      border-radius: 3px; font-size: 14px; font-family: var(--mono);
    }
    .path-form input:focus { outline:none; border-color:var(--accent); box-shadow: 0 0 0 2px var(--accent-light); }
    
    .btn {
      padding: 8px 16px; border: 1px solid var(--border); border-radius: 3px;
      font-size: 13px; cursor: pointer; background: var(--surface); color: var(--text);
      font-family: var(--sans); text-decoration: none; display: inline-block;
    }
    .btn:hover { background: #f0efeb; border-color: #999; }
    .btn-primary { background: var(--accent); color: white; border-color: var(--accent); }
    .btn-primary:hover { background: #1e3a5f; }
    
    .client-list { display: flex; flex-direction: column; gap: 4px; }
    .client-card {
      display: flex; align-items: center; padding: 12px 16px;
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 4px; text-decoration: none; color: var(--text);
      transition: all 0.12s; cursor: pointer;
    }
    .client-card:hover {
      background: var(--accent-light); border-color: var(--accent);
      transform: translateX(2px);
    }
    .client-card .icon { font-size: 20px; margin-right: 12px; }
    .client-card .info { flex: 1; }
    .client-card .name { font-weight: 600; font-size: 15px; }
    .client-card .meta { font-size: 12px; color: var(--muted); margin-top: 2px; }
    .client-card .arrow { color: #ccc; font-size: 18px; }
    
    .client-card.new-client {
      border-style: dashed; background: transparent;
    }
    .client-card.new-client:hover { background: #f7fafc; }
    
    .new-form {
      display: flex; gap: 8px; align-items: center; margin-top: 12px;
    }
    .new-form input {
      flex: 1; padding: 8px 12px; border: 1px solid var(--border);
      border-radius: 3px; font-size: 14px;
    }
    .new-form input:focus { outline:none; border-color:var(--accent); box-shadow: 0 0 0 2px var(--accent-light); }
    
    .hint {
      margin-top: 24px; padding: 16px; background: #f7fafc;
      border-radius: 4px; font-size: 13px; color: var(--muted);
      line-height: 1.6;
    }
    .hint strong { color: var(--text); }
  </style>
</head>
<body>
  <div class="header">
    <h1>GRID</h1>
    <span class="tag">Accounting</span>
  </div>
  
  <div class="container">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% for category, message in messages %}
        <div class="flash flash-{{ category }}">{{ message }}</div>
      {% endfor %}
    {% endwith %}
    
    <!-- Library Path Setup -->
    <div class="section">
      <h2>üìÅ File Library</h2>
      <p>This is the folder where your client files live. Each client gets their own subfolder with a <code>books.db</code> file inside it.</p>
      <form method="post" action="/library/set-path" class="path-form">
        <input type="text" name="library_path" value="{{ library_path }}" 
               placeholder="e.g. B:\Box\Clients  or  C:\Users\YourName\Documents\Clients">
        <button type="submit" class="btn btn-primary">Set Path</button>
      </form>
    </div>
    
    {% if library_path %}
    <!-- Client List -->
    <div class="section">
      <h2>üìã Clients</h2>
      
      {% if clients %}
      <div class="client-list">
        {% for c in clients %}
        {% if c.exists %}
        <a href="/open?path={{ c.path | urlencode }}" class="client-card">
          <span class="icon">üìí</span>
          <div class="info">
            <div class="name">{{ c.name }}</div>
            <div class="meta">Last modified: {{ c.modified }} ¬∑ {{ (c.size / 1024)|round(0)|int }} KB</div>
          </div>
          <span class="arrow">‚ñ∏</span>
        </a>
        {% else %}
        <div class="client-card" style="opacity:0.5; cursor:default;">
          <span class="icon">üìÇ</span>
          <div class="info">
            <div class="name">{{ c.name }}</div>
            <div class="meta">Folder exists but no books.db file</div>
          </div>
        </div>
        {% endif %}
        {% endfor %}
      </div>
      {% else %}
      <p style="padding:20px; text-align:center; color:var(--muted);">
        No client folders found in <code>{{ library_path }}</code>
      </p>
      {% endif %}
      
      <!-- New Client -->
      <form method="post" action="/library/new-client" class="new-form">
        <input type="text" name="client_name" placeholder="New client name (becomes the folder name)">
        <button type="submit" class="btn btn-primary">+ Create</button>
        <a href="/clone" class="btn" style="margin-left:4px">Clone Existing</a>
      </form>
    </div>
    {% endif %}
    
    <div class="hint">
      <strong>How this works:</strong><br>
      ‚Ä¢ Set the path above to a folder (like your Box Drive).<br>
      ‚Ä¢ Each client is a subfolder. Inside it is one file: <code>books.db</code>.<br>
      ‚Ä¢ That's the whole thing. Box syncs it. Copy the folder to back up.<br>
      ‚Ä¢ There are no other files, no hidden data, no proprietary formats.
    </div>
  </div>
</body>
</html>
